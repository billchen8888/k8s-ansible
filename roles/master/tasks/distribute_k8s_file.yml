- name: "Distribute K8s Master Binary File"
  copy:
    src: "{{ package_root_dir }}/k8s/{{ kubernetes_version }}/kubernetes/server/bin/{{ item }}"
    dest: "{{ workdir }}/kubernetes/bin"
    mode: 0755
  with_items:
    - kubectl
    - kube-apiserver
    - kube-controller-manager
    - kube-scheduler

- name: "Distribute K8s Certs"
  copy:
    src: "{{ cert_root_dir }}/{{ item }}"
    dest: "{{ workdir }}/kubernetes/ssl"
  with_items:
    - ca.pem
    - ca-key.pem
    - server.pem
    - server-key.pem
    - metrics-server.pem
    - metrics-server-key.pem

# next section is added by BC for v1.20
- name: "Distribute K8s Certs"
  copy:
    src: "{{ cert_root_dir }}/{{ item }}"
    dest: "{{ workdir }}/kubernetes/ssl"
  with_items:
    - kube-controller.pem
    - kube-controller-key.pem
    - kube-scheduler.pem
    - kube-scheduler-key.pem
  when: kubernetes_version is version('1.20.0', '>=')
# end BC

- name: "Distribute Token.csv"
  copy:
    src: "{{ cert_root_dir }}/token.csv"
    dest: "{{ workdir }}/kubernetes/cfg"

- name: "Write Kubectl Command to Profile"
  template:
    src: kubectl.sh.j2
    dest: /etc/profile.d/kubectl.sh
    mode: 0755
